{"ast":null,"code":"import Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/torre.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/common\";\nfunction ListarTorresComponent_tr_31_button_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"button\", 12);\n    i0.ÉµÉµlistener(\"click\", function ListarTorresComponent_tr_31_button_22_Template_button_click_0_listener() {\n      i0.ÉµÉµrestoreView(_r7);\n      const torre_r1 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r5 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r5.editarTorre(torre_r1._id));\n    });\n    i0.ÉµÉµtext(1, \"Editar\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction ListarTorresComponent_tr_31_button_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"button\", 13);\n    i0.ÉµÉµlistener(\"click\", function ListarTorresComponent_tr_31_button_23_Template_button_click_0_listener() {\n      i0.ÉµÉµrestoreView(_r10);\n      const torre_r1 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r8 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r8.enviarMensaje(torre_r1));\n    });\n    i0.ÉµÉµtext(1, \"Enviar\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction ListarTorresComponent_tr_31_button_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"button\", 14);\n    i0.ÉµÉµlistener(\"click\", function ListarTorresComponent_tr_31_button_24_Template_button_click_0_listener() {\n      i0.ÉµÉµrestoreView(_r13);\n      const torre_r1 = i0.ÉµÉµnextContext().$implicit;\n      const ctx_r11 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r11.eliminarTorre(torre_r1._id));\n    });\n    i0.ÉµÉµtext(1, \"Eliminar\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nconst _c0 = function (a0, a1) {\n  return {\n    \"enviado\": a0,\n    \"no-enviado\": a1\n  };\n};\nfunction ListarTorresComponent_tr_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"td\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"td\");\n    i0.ÉµÉµtext(6);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"td\");\n    i0.ÉµÉµtext(8);\n    i0.ÉµÉµpipe(9, \"date\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(10, \"td\");\n    i0.ÉµÉµtext(11);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(12, \"td\");\n    i0.ÉµÉµtext(13);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(14, \"td\");\n    i0.ÉµÉµtext(15);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(16, \"td\");\n    i0.ÉµÉµtext(17);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(18, \"td\", 7);\n    i0.ÉµÉµtext(19);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(20, \"td\")(21, \"div\", 8);\n    i0.ÉµÉµtemplate(22, ListarTorresComponent_tr_31_button_22_Template, 2, 0, \"button\", 9);\n    i0.ÉµÉµtemplate(23, ListarTorresComponent_tr_31_button_23_Template, 2, 0, \"button\", 10);\n    i0.ÉµÉµtemplate(24, ListarTorresComponent_tr_31_button_24_Template, 2, 0, \"button\", 11);\n    i0.ÉµÉµelementEnd()()();\n  }\n  if (rf & 2) {\n    const torre_r1 = ctx.$implicit;\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.residencia);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.nombre);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.apto);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(i0.ÉµÉµpipeBind1(9, 13, torre_r1.fecha));\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate(torre_r1.nombrePersona);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.celular);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.nivelInfestacion);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(torre_r1.recomendaciones);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngClass\", i0.ÉµÉµpureFunction2(15, _c0, torre_r1.estadoMensaje === \"enviado\", torre_r1.estadoMensaje !== \"sin enviar\"));\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(torre_r1.estadoMensaje);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµproperty(\"ngIf\", torre_r1._id);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", torre_r1._id);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", torre_r1._id);\n  }\n}\nexport let ListarTorresComponent = /*#__PURE__*/(() => {\n  class ListarTorresComponent {\n    constructor(torresService, router, toastr) {\n      this.torresService = torresService;\n      this.router = router;\n      this.toastr = toastr;\n      this.torres = [];\n    }\n    ngOnInit() {\n      this.obtenerTorres();\n    }\n    obtenerTorres() {\n      this.torresService.obtenerTorres().subscribe(torres => {\n        this.torres = torres;\n        console.log(torres);\n      }, error => {\n        console.log('Error al obtener las torres:', error);\n      });\n    }\n    editarTorre(torreId) {\n      if (torreId !== null) {\n        console.log(torreId);\n        this.router.navigate(['/editar-torre', torreId]);\n      }\n    }\n    enviarMensaje(torre) {\n      if (!torre) {\n        // Manejar el caso en que torre sea undefined\n        this.toastr.error('La torre seleccionada no es vÃ¡lida.', 'Error');\n        return; // Salir de la funciÃ³n si torre no estÃ¡ definida\n      }\n\n      const nombre = torre.nombrePersona;\n      const fecha = torre.fecha;\n      const nivelInfestacion = torre.nivelInfestacion;\n      const recomendaciones = torre.recomendaciones;\n      const mensaje = `\n    *Certificado fumigaciÃ³n:*\n    Â¡Hola ${nombre}! De acuerdo al servicio realizado para el control de plagas el dÃ­a *${fecha}*, evidenciamos un nivel de infestaciÃ³n: *${nivelInfestacion}*. \n    Recuerda la importancia de seguir con el orden y de fumigar periÃ³dicamente. \n  \n    Si el tÃ©cnico evidenciÃ³ que no tienes infestaciÃ³n, ten en cuenta que es normal seguir viendo cucarachas y otros animalitos ya que estos serÃ¡n solo de paso y no se quedarÃ¡n en tu hogar gracias a las propiedades piretroides del veneno. \n  \n    De lo contrario, si se evidenciÃ³ infestaciÃ³n, te aconsejamos llamarnos o escribirnos para una nueva fumigaciÃ³n. \n    Recomendaciones: *${recomendaciones}*, si tienes alguna inquietud nos puedes escribir a este nÃºmero,\n    Recuerda que realizamos servicios para: fincas, apartamentos, locales, bodegas, empresas, oficinas, hospitales, transporte pÃºblico, etc.\n    Cordialmente: Expres Fumigaciones. Â¡Feliz dÃ­a! Â©\n    `;\n      const numeroTelefono = torre.celular;\n      Swal.fire({\n        title: 'Por favor continua a wpp y verifica que los datos del mensaje esten bien antes de enviarlo',\n        text: 'Se enviarÃ¡ un mensaje de WhatsApp al cliente con la informaciÃ³n del servicio, si envia el mensaje su estado cambia a \"enviado\" y no podra reversarlo.',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonText: 'Continuar al wpp ðŸŸ¢',\n        cancelButtonText: 'Cancelar',\n        customClass: {\n          confirmButton: 'swal2-confirm',\n          cancelButton: 'swal2-cancel'\n        },\n        background: '#ffffff'\n      }).then(result => {\n        if (result.isConfirmed) {\n          if (numeroTelefono) {\n            // Verificar si torre._id es vÃ¡lido\n            if (torre._id) {\n              this.torresService.marcarMensajeEnviado(torre._id).subscribe(() => {\n                // Cambiar el estado de la torre a \"enviado\" aquÃ­\n                // ...\n                const enlaceWhatsApp = `https://wa.me/${numeroTelefono}?text=${encodeURIComponent(String(mensaje))}`;\n                window.open(enlaceWhatsApp, '_blank');\n              }, error => {\n                console.log('Error al marcar el mensaje como enviado:', error);\n              });\n            } else {\n              this.toastr.error('No se encontrÃ³ un ID vÃ¡lido para esta torre.', 'Error');\n            }\n          } else {\n            this.toastr.error('No se encontrÃ³ un nÃºmero de telÃ©fono vÃ¡lido para esta torre.', 'Error');\n          }\n        }\n      });\n    }\n    eliminarTorre(torreId) {\n      if (torreId) {\n        Swal.fire({\n          title: 'Â¿EstÃ¡s seguro?',\n          text: 'Esta acciÃ³n no se puede deshacer',\n          icon: 'warning',\n          showCancelButton: true,\n          confirmButtonText: 'SÃ­, eliminar',\n          cancelButtonText: 'Cancelar'\n        }).then(result => {\n          if (result.isConfirmed) {\n            // LÃ³gica de eliminaciÃ³n aquÃ­\n            // Llama al servicio para eliminar la torre\n            this.torresService.eliminarTorre(torreId).subscribe(() => {\n              // EliminaciÃ³n exitosa\n              Swal.fire('Eliminada', 'La torre ha sido eliminada con Ã©xito', 'success');\n              // Actualizar la lista de torres despuÃ©s de eliminar\n              this.obtenerTorres();\n            }, error => {\n              console.log('Error al eliminar la torre:', error);\n            });\n          }\n        });\n      }\n    }\n  }\n  ListarTorresComponent.Éµfac = function ListarTorresComponent_Factory(t) {\n    return new (t || ListarTorresComponent)(i0.ÉµÉµdirectiveInject(i1.TorresService), i0.ÉµÉµdirectiveInject(i2.Router), i0.ÉµÉµdirectiveInject(i3.ToastrService));\n  };\n  ListarTorresComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n    type: ListarTorresComponent,\n    selectors: [[\"app-listar-torres\"]],\n    decls: 32,\n    vars: 1,\n    consts: [[1, \"custom-container\", \"mt-5\", 2, \"width\", \"90%\", \"margin\", \"0 auto\"], [1, \"head-form\"], [\"routerLink\", \"/servicio-torres\", 1, \"btn\", \"btn-primary\", \"float-end\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-plus\"], [1, \"table\"], [1, \"trs\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngClass\"], [1, \"accionesbtn\"], [\"class\", \"btn\", \"id\", \"editar\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn\", \"id\", \"guardar\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn\", \"id\", \"eliminar\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"editar\", 1, \"btn\", 3, \"click\"], [\"id\", \"guardar\", 1, \"btn\", 3, \"click\"], [\"id\", \"eliminar\", 1, \"btn\", 3, \"click\"]],\n    template: function ListarTorresComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n        i0.ÉµÉµtext(3, \"Servicios\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(4, \"button\", 2);\n        i0.ÉµÉµelement(5, \"i\", 3);\n        i0.ÉµÉµtext(6, \" Nuevo registro\");\n        i0.ÉµÉµelementEnd()();\n        i0.ÉµÉµelementStart(7, \"table\", 4)(8, \"thead\")(9, \"tr\", 5)(10, \"th\");\n        i0.ÉµÉµtext(11, \"Residencia\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(12, \"th\");\n        i0.ÉµÉµtext(13, \"# Torre\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(14, \"th\");\n        i0.ÉµÉµtext(15, \"# Apto\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(16, \"th\");\n        i0.ÉµÉµtext(17, \"Fecha\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(18, \"th\");\n        i0.ÉµÉµtext(19, \"Nombre\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(20, \"th\");\n        i0.ÉµÉµtext(21, \"Celular\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(22, \"th\");\n        i0.ÉµÉµtext(23, \"Nivel de Infestaci\\u00F3n\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(24, \"th\");\n        i0.ÉµÉµtext(25, \"Recomendaciones\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(26, \"th\");\n        i0.ÉµÉµtext(27, \"Estado del msj\");\n        i0.ÉµÉµelementEnd();\n        i0.ÉµÉµelementStart(28, \"th\");\n        i0.ÉµÉµtext(29, \"Acciones\");\n        i0.ÉµÉµelementEnd()()();\n        i0.ÉµÉµelementStart(30, \"tbody\");\n        i0.ÉµÉµtemplate(31, ListarTorresComponent_tr_31_Template, 25, 18, \"tr\", 6);\n        i0.ÉµÉµelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ÉµÉµadvance(31);\n        i0.ÉµÉµproperty(\"ngForOf\", ctx.torres);\n      }\n    },\n    dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i2.RouterLink, i4.DatePipe],\n    styles: [\".custom-container[_ngcontent-%COMP%]{box-shadow:0 0 11px 3px #00000056!important;background-color:#0000006c;color:#fff!important;padding:20px}.table[_ngcontent-%COMP%]{color:#fff}h2[_ngcontent-%COMP%]{width:20%}.head-form[_ngcontent-%COMP%]{display:flex;padding:10px;justify-content:space-between;border-radius:10px}.btn[_ngcontent-%COMP%]{position:relative;font-size:12px;text-transform:uppercase;text-decoration:none;display:inline-block;border-radius:5px;transition:all .2s;border:none;font-family:inherit;font-weight:500;color:#000;background-color:#fff;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 10px 20px #ececec14}.btn[_ngcontent-%COMP%]:active{transform:translateY(-1px);box-shadow:0 5px 10px #d1d1d133}.btn[_ngcontent-%COMP%]:after{content:\\\"\\\";display:inline-block;height:90%;width:90%;border-radius:100px;position:absolute;top:0;left:0;z-index:-1;transition:all .4s}.btn[_ngcontent-%COMP%]:after{background-color:#f7f7f730}.btn[_ngcontent-%COMP%]:hover:after{transform:scaleX(1.4) scaleY(1.6);opacity:0}#guardar[_ngcontent-%COMP%]{background-color:green;color:#fff;height:30px}#cancelar[_ngcontent-%COMP%]{background-color:#e0d100;color:#000;height:30px}#editar[_ngcontent-%COMP%]{background-color:#0069f2;color:#fff;height:30px}#eliminar[_ngcontent-%COMP%]{background-color:#ff000093;color:#fff;height:30px}#verregistros[_ngcontent-%COMP%]{background-color:#0072b8;color:#fff;height:30px}.accionesbtn[_ngcontent-%COMP%]{display:grid;gap:8px}.table[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(caption) > *[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.5rem;color:var(--bs-table-color-state,var(--bs-table-color-type,var(--bs-table-color)));background-color:#0000006d;color:#fff;border-bottom-width:var(--bs-border-width);box-shadow:inset 0 0 0 9999px var(--bs-table-bg-state,var(--bs-table-bg-type,var(--bs-table-accent-bg)))}.enviado[_ngcontent-%COMP%]{color:red}.enviado[_ngcontent-%COMP%]{color:green!important}\"]\n  });\n  return ListarTorresComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}