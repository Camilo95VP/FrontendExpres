{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport Swal from 'sweetalert2';\nlet ListarTorresComponent = class ListarTorresComponent {\n  constructor(torresService, router, toastr, formBuilder) {\n    this.torresService = torresService;\n    this.router = router;\n    this.toastr = toastr;\n    this.formBuilder = formBuilder;\n    this.torresFiltradas = [];\n    this.torres = [];\n    this.residencia = '';\n    this.torre = '';\n    this.fecha = null;\n    this.estadoMensaje = '';\n    this.filtroForm = this.formBuilder.group({\n      residencia: [''],\n      torre: [''],\n      fecha: [''],\n      estadoMensaje: ['']\n    });\n  }\n  ngOnInit() {\n    this.obtenerTorres();\n  }\n  obtenerTorres() {\n    this.torresService.obtenerTorres().subscribe(torres => {\n      this.torres = torres;\n      console.log(torres);\n    }, error => {\n      console.log('Error al obtener las torres:', error);\n    });\n  }\n  editarTorre(torreId) {\n    if (torreId !== null) {\n      console.log(torreId);\n      this.router.navigate(['/editar-torre', torreId]);\n    }\n  }\n  enviarMensaje(torre) {\n    if (!torre) {\n      // Manejar el caso en que torre sea undefined\n      this.toastr.error('La torre seleccionada no es v谩lida.', 'Error');\n      return; // Salir de la funci贸n si torre no est谩 definida\n    }\n\n    const nombre = torre.nombrePersona;\n    const fecha = torre.fecha;\n    const nivelInfestacion = torre.nivelInfestacion;\n    const recomendaciones = torre.recomendaciones;\n    const mensaje = `\n    *Certificado fumigaci贸n:*\n    隆Hola ${nombre}! De acuerdo al servicio realizado para el control de plagas el d铆a *${fecha}*, evidenciamos un nivel de infestaci贸n: *${nivelInfestacion}*. \n    Recuerda la importancia de seguir con el orden y de fumigar peri贸dicamente. \n  \n    Si el t茅cnico evidenci贸 que no tienes infestaci贸n, ten en cuenta que es normal seguir viendo cucarachas y otros animalitos ya que estos ser谩n solo de paso y no se quedar谩n en tu hogar gracias a las propiedades piretroides del veneno. \n  \n    De lo contrario, si se evidenci贸 infestaci贸n, te aconsejamos llamarnos o escribirnos para una nueva fumigaci贸n. \n    Recomendaciones: *${recomendaciones}*, si tienes alguna inquietud nos puedes escribir a este n煤mero,\n    Recuerda que realizamos servicios para: fincas, apartamentos, locales, bodegas, empresas, oficinas, hospitales, transporte p煤blico, etc.\n    Cordialmente: Expres Fumigaciones. 隆Feliz d铆a! 漏\n    `;\n    const numeroTelefono = \"+57\" + torre.celular;\n    Swal.fire({\n      title: 'Por favor continua a wpp y verifica que los datos del mensaje esten bien antes de enviarlo',\n      text: 'Se enviar谩 un mensaje de WhatsApp al cliente con la informaci贸n del servicio, si envia el mensaje su estado cambia a \"enviado\" y no podra reversarlo.',\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonText: 'Continuar al wpp ',\n      cancelButtonText: 'Cancelar',\n      customClass: {\n        confirmButton: 'swal2-confirm',\n        cancelButton: 'swal2-cancel'\n      },\n      background: '#ffffff'\n    }).then(result => {\n      if (result.isConfirmed) {\n        if (numeroTelefono) {\n          // Verificar si torre._id es v谩lido\n          if (torre._id) {\n            this.torresService.marcarMensajeEnviado(torre._id).subscribe(() => {\n              // Cambiar el estado de la torre a \"enviado\" aqu铆\n              // ...\n              const enlaceWhatsApp = `https://wa.me/${numeroTelefono}?text=${encodeURIComponent(String(mensaje))}`;\n              window.open(enlaceWhatsApp, '_blank');\n              location.reload();\n            }, error => {\n              console.log('Error al marcar el mensaje como enviado:', error);\n            });\n          } else {\n            this.toastr.error('No se encontr贸 un ID v谩lido para esta torre.', 'Error');\n          }\n        } else {\n          this.toastr.error('No se encontr贸 un n煤mero de tel茅fono v谩lido para esta torre.', 'Error');\n        }\n      }\n    });\n  }\n  eliminarTorre(torreId) {\n    if (torreId) {\n      Swal.fire({\n        title: '驴Est谩s seguro?',\n        text: 'Esta acci贸n no se puede deshacer',\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonText: 'S铆, eliminar',\n        cancelButtonText: 'Cancelar'\n      }).then(result => {\n        if (result.isConfirmed) {\n          // L贸gica de eliminaci贸n aqu铆\n          // Llama al servicio para eliminar la torre\n          this.torresService.eliminarTorre(torreId).subscribe(() => {\n            // Eliminaci贸n exitosa\n            Swal.fire('Eliminada', 'La torre ha sido eliminada con 茅xito', 'success');\n            // Actualizar la lista de torres despu茅s de eliminar\n            this.obtenerTorres();\n          }, error => {\n            console.log('Error al eliminar la torre:', error);\n          });\n        }\n      });\n    }\n  }\n  filtrarTorres() {\n    // Obtener los criterios de filtro del formulario\n    const residencia = this.residencia.toLowerCase();\n    const nombre = this.torre.toLowerCase();\n    const fecha = this.fecha;\n    const estadoMensaje = this.estadoMensaje.toLowerCase();\n    this.torresFiltradas = this.torres.filter(torre => {\n      // Convertir la fecha de la torre a un objeto Date\n      const fechaTorre = new Date(torre.fecha);\n      // Realizar la comparaci贸n de fechas, por ejemplo, si son iguales\n      return (residencia === '' || torre.residencia.toLowerCase().includes(residencia)) && (nombre === '' || torre.nombre.toLowerCase().includes(nombre)) && (!fecha || fechaTorre.getTime() === fecha.getTime()) && (\n      // Comparaci贸n de fechas\n      !estadoMensaje || torre.estadoMensaje.toLowerCase().includes(estadoMensaje));\n    });\n  }\n};\nListarTorresComponent = __decorate([Component({\n  selector: 'app-listar-torres',\n  templateUrl: './listar-torres.component.html',\n  styleUrls: ['./listar-torres.component.css']\n})], ListarTorresComponent);\nexport { ListarTorresComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}